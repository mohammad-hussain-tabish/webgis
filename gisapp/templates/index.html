{% load static %}
<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web GIS - OpenLayers</title>

    <!-- OpenLayers CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'kabul/style.css' %}" />
    <link rel="stylesheet" href="{% static 'kabul/css/main.css' %}" />
  </head>

  <body>
    <!-- Header with logos -->
    <div class="header">
      <img
        class="logo"
        src="{% static 'kabul/images/WhatsApp_Image_2025-05-15_at_9.52.25_AM-removebg-preview.png' %}"
        alt="MOHE Logo"
      />
      <h1>Ù†Ù‚Ø´Ù‡ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ Ø´Ù‡Ø± Ú©Ø§Ø¨Ù„</h1>
      <img
        class="logo"
        src="{% static 'kabul/images/New_GE_Logo_1-removebg-preview.png' %}"
        alt="KPU Logo"
      />
      <button onclick="window.location.href='{% url 'logout' %}'" class="logout-btn">Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- Note Toggle Button -->
    <button class="note-toggle-button" id="noteToggleButton">ğŸ“</button>

    <!-- Sticky Note Panel -->
    <div class="sticky-note" id="stickyNote">
      <div class="sticky-note-header" id="stickyNoteHeader">
        <h3 class="sticky-note-title">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h3>
        <div class="sticky-note-controls">
          <button id="minimizeNote" title="Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù†">_</button>
          <button id="deleteNote" title="Ø­Ø°Ù">Ã—</button>
        </div>
      </div>
      <div class="sticky-note-content">
        <textarea
          id="noteContent"
          placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
        ></textarea>
      </div>
      <div class="sticky-note-footer">
        <button class="save-btn" id="saveNote">Ø°Ø®ÛŒØ±Ù‡</button>
        <button class="cancel-btn" id="cancelEdit">Ù„ØºÙˆ</button>
      </div>
    </div>

    <!-- OpenLayers Map -->
    <div id="map">
      <div class="layer-switcher">
        <div class="layer-switcher-container">
          <div class="layer-switcher__icon"></div>
        </div>
        <div class="layer-switcher__content"></div>
      </div>
      <div class="tooltip-bottom"></div>
      <div class="search-box">
        <div class="search-button"></div>
        <input class="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ" type="text" />
      </div>
    </div>
  </div>
  <!-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ -->
   <div class="navigation-panel" id="navigationPanel">
   <div class="navigation-panel__drag-handle" id="navigationPanelHandle">â‹®â‹®</div>
   <button id="locateMe" class="control-button">ğŸ“ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†</button>
   <button id="startRouting" class="control-button">ğŸš— Ø´Ø±ÙˆØ¹ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ</button>
   <button id="clearRoute" class="control-button">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ±</button>
   <div id="routeInfo"></div>
 </div>

  <!-- Tools -->
  <div class="tools">
    <div>
      <button id="cityInfoBtn" class="city-info-btn" title="Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù…Ø´Ù‡ÙˆØ± Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†">
       <i class="fas fa-city" style="font-size:28px;color:#2e6be6;padding-right:10px;"></i>
      </button>
    </div>

  <!-- City Info Modal -->
<div class="modal" id="cityInfoModal">
  <div class="modal-content">
    <span class="close" id="closeCityInfoModal">&times;</span>
    <h2>Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù…Ø´Ù‡ÙˆØ± Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</h2>
    <div class="city-details">
      <h3>Ú©Ø§Ø¨Ù„</h3>
      <p>Ú©Ø§Ø¨Ù„ Ù¾Ø§ÛŒØªØ®Øª Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† Ùˆ Ø¨Ø²Ø±Ú¯ØªØ±ÛŒÙ† Ø´Ù‡Ø± Ø§ÛŒÙ† Ú©Ø´ÙˆØ± Ø§Ø³Øª. Ø§ÛŒÙ† Ø´Ù‡Ø± Ù…Ø±Ú©Ø² ÙØ±Ù‡Ù†Ú¯ÛŒØŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ùˆ Ø³ÛŒØ§Ø³ÛŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.</p>
      <img src="{% static 'kabul/images/kabul.jpg' %}" alt="Kabul" class="city-img">
      <hr>
      <h3>Ù‡Ø±Ø§Øª</h3>
      <p>Ù‡Ø±Ø§Øª ÛŒÚ©ÛŒ Ø§Ø² Ø´Ù‡Ø±Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ ÙØ±Ù‡Ù†Ú¯ÛŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ù…Ø¹Ù…Ø§Ø±ÛŒ Ùˆ Ø¢Ø«Ø§Ø± Ø¨Ø§Ø³ØªØ§Ù†ÛŒâ€ŒØ§Ø´ Ù…Ø´Ù‡ÙˆØ± Ø§Ø³Øª.</p>
      <img src="{% static 'kabul/images/herat.jpg' %}" alt="Herat" class="city-img">
      <hr>
      <h3>Ù…Ø²Ø§Ø± Ø´Ø±ÛŒÙ</h3>
      <p>Ù…Ø²Ø§Ø± Ø´Ø±ÛŒÙ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø±ÙˆØ¶Ù‡ Ù…Ø¨Ø§Ø±Ú© Ùˆ Ø¬Ø´Ù† Ù†ÙˆØ±ÙˆØ² Ø´Ù‡Ø±Øª Ø¯Ø§Ø±Ø¯ Ùˆ ÛŒÚ©ÛŒ Ø§Ø² Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù… Ø´Ù…Ø§Ù„ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† Ø§Ø³Øª.</p>
      <img src="{% static 'kabul/images/mazar.jpg' %}" alt="Mazar" class="city-img">
      <!-- ... add more cities as needed ... -->
    </div>
    <div style="margin-top:20px;">
      <button id="cityImageUploadBtn" class="upload-btn">Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ Ø´Ù‡Ø±</button>
      <input type="file" id="cityImageInput" style="display:none;" accept="image/*">
      <div id="cityImagePreview"></div>
    </div>
  </div>
</div>

    <div class="drawing-control">
      <div class="drawing-control__icon drawing-control__icon--toggler"></div>
      <div class="drawing-control__icon drawing-control__icon--point"></div>
      <div class="drawing-control__icon drawing-control__icon--line"></div>
      <div class="drawing-control__icon drawing-control__icon--polygon"></div>
      <div class="drawing-control__icon drawing-control__icon--finish"></div>
      <div class="drawing-control__icon drawing-control__icon--clear"></div>
    </div>
    
    <div class="measurement-control">
      <div
      class="measurement-control__icon measurement-control__icon--toggler"
      ></div>
      <div
      class="measurement-control__icon measurement-control__icon--distance"
      ></div>
      <div
      class="measurement-control__icon measurement-control__icon--area"
      ></div>
    </div>
    
    <div class="identify">
      <div class="identify__icon"></div>
        <div class="identify__content">
          <div class="identify__header">
            <div class="identify__title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ø§Ø±Ø¶Ù‡</div>
          </div>
          <div class="identify__layout">
            <div class="identify__data">
              <div class="identify__select"></div>
              <div class="identify__result"></div>
            </div>
            <div class="identify__photo-panel">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 10px;
                "
              >
                <h3>Ø¹Ú©Ø³â€ŒÙ‡Ø§</h3>
                <button class="identify__add-photo" id="addPhotoBtn">
                  Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³
                </button>
              </div>
              <div class="identify__photo-container" id="photoContainer">
                <div class="identify__no-photo">
                  Ù‡ÛŒÚ† Ø¹Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¹Ø§Ø±Ø¶Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Photo Upload Modal -->
    <div class="photo-modal" id="photoModal">
      <div class="photo-modal__content">
        <div class="photo-modal__header">
          <div class="photo-modal__title">Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯</div>
          <button class="photo-modal__close" id="closeModalBtn">&times;</button>
        </div>
        <form
          class="photo-modal__form"
          id="photoUploadForm"
          enctype="multipart/form-data"
        >
          <div>
            <label for="photoFile">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³:</label>
            <input
              type="file"
              id="photoFile"
              name="photo"
              accept="image/*"
              required
            />
          </div>
          <img class="photo-modal__preview" id="photoPreview" />
          <div>
            <label for="photoDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¹Ú©Ø³:</label>
            <textarea
              class="photo-modal__description"
              id="photoDescription"
              name="description"
              placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¹Ú©Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
            ></textarea>
          </div>
          <button type="submit" class="photo-modal__submit">Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³</button>
        </form>
      </div>
    </div>

    <script>
document.getElementById('cityInfoBtn').onclick = function() {
  document.getElementById('cityInfoModal').style.display = 'flex';
};
document.getElementById('closeCityInfoModal').onclick = function() {
  document.getElementById('cityInfoModal').style.display = 'none';
};
window.onclick = function(event) {
  const modal = document.getElementById('cityInfoModal');
  if (event.target === modal) modal.style.display = 'none';
};

// Image upload preview
document.getElementById('cityImageUploadBtn').onclick = function() {
  document.getElementById('cityImageInput').click();
};
document.getElementById('cityImageInput').onchange = function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(evt) {
      document.getElementById('cityImagePreview').innerHTML =
        '<img src="' + evt.target.result + '" alt="City Image">';
    };
    reader.readAsDataURL(file);
  }
};
</script>

<script>
const panel = document.getElementById('navigationPanel');
const handle = document.getElementById('navigationPanelHandle');
let isDragging = false, offsetX = 0, offsetY = 0;

handle.addEventListener('mousedown', function(e) {
  isDragging = true;
  const rect = panel.getBoundingClientRect();
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;
  document.body.style.userSelect = 'none';
});

document.addEventListener('mousemove', function(e) {
  if (isDragging) {
    // Calculate new position
    let newLeft = e.clientX - offsetX;
    let newTop = e.clientY - offsetY;
    // Prevent moving out of viewport
    newLeft = Math.max(0, Math.min(window.innerWidth - panel.offsetWidth, newLeft));
    newTop = Math.max(0, Math.min(window.innerHeight - panel.offsetHeight, newTop));
    panel.style.left = newLeft + 'px';
    panel.style.top = newTop + 'px';
    panel.style.right = 'auto';
    panel.style.bottom = 'auto';
  }
});

document.addEventListener('mouseup', function() {
  isDragging = false;
  document.body.style.userSelect = '';
});
</script>
    <!-- Scripts -->
    <script src="{% static 'kabul/proxy.js' %}"></script>
    <script src="{% static 'kabul/js/map.js' %}"></script>
    <script src="{% static 'kabul/js/drawingControl.js' %}"></script>
    <script src="{% static 'kabul/js/measurementControl.js' %}"></script>
    <script src="{% static 'kabul/js/notes.js' %}"></script>
    <script src="{% static 'kabul/js/identify.js' %}"></script>
    <script src="{% static 'kabul/js/layerSwitcher.js' %}"></script>
    <script src="{% static 'kabul/js/photoUpload.js' %}"></script>
    <script src="{% static 'kabul/js/MASER.js' %}"></script>
  </body>
</html>
