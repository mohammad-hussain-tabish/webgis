{% load static %}
<!-- <!DOCTYPE html> -->
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web GIS - OpenLayers</title>

    <!-- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² CDN Ø¨Ø±Ø§ÛŒ OpenLayers -->
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css"
    />
    <link rel="stylesheet" href="{% static 'kabul/style.css' %}" />
    <div class="search-box">
      <div class="search-button"></div>
      <input class="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ" type="text">
    </div>
    <!-- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ -->
    <style>
      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ */
      #map {
        width: 100%;
        height: 599px;
        margin: 0;
        transition: width 0.3s ease, margin-right 0.3s ease;
      }

      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ø± */
      .header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        text-align: center;
        position: fixed;
        width: 100%;
        z-index: 3;
        margin: 20px 0;
        background-color: transparent;
        transition: width 0.3s ease, margin-right 0.3s ease;
      }
      
      body.body-shifted .header {
        width: 70%;
        margin-right: 30%;
      }

      .header img {
        width: 80px;
        height: auto;
      }

      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ */
      .layer-switcher,
      .drawing-control,
      .identify,
      .measurement-control,
      .search-box,
      .user-button {
        margin: 5px;
        padding: 5px;
        transition: right 0.3s ease, margin-right 0.3s ease;
      }
      
      body.body-shifted .layer-switcher,
      body.body-shifted .user-button {
        margin-right: 30%;
      }

      .search-input {
        padding: 5px;
        margin: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .logo{
        background-color: white;
        border-radius: 40px;
      }

      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª */
      .sticky-note {
        position: absolute;
        top: 50px;
        left: 80px;
        width: 250px;
        background-color: #fff8dc;
        border: 1px solid #e6d798;
        border-radius: 5px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        direction: rtl;
        font-family: 'Tahoma', sans-serif;
        display: none;
      }

      .sticky-note-header {
        background-color: #00ff00;
        padding: 5px 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 5px 5px 0 0;
        cursor: move;
      }

      .sticky-note-title {
        font-weight: bold;
        margin: 0;
      }

      .sticky-note-controls {
        display: flex;
        gap: 5px;
      }

      .sticky-note-controls button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        padding: 0;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 3px;
      }

      .sticky-note-controls button:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .sticky-note-content {
        padding: 10px;
      }

      .sticky-note textarea {
        width: 100%;
        min-height: 100px;
        border: 1px solid #00ff00;
        border-radius: 3px;
        padding: 5px;
        resize: vertical;
        font-family: 'Tahoma', sans-serif;
        direction: rtl;
      }

      .sticky-note-footer {
        padding: 5px 10px;
        display: flex;
        justify-content: flex-end;
        gap: 5px;
      }

      .sticky-note-footer button {
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-family: 'Tahoma', sans-serif;
      }

      .save-btn {
        background-color: #4caf50;
        color: white;
      }

      .cancel-btn {
        background-color: #f44336;
        color: white;
      }

      .minimize-btn {
        background-color: #f5e79e;
      }

      .sticky-note.minimized .sticky-note-content,
      .sticky-note.minimized .sticky-note-footer {
        display: none;
      }
      
      /* Ø¯Ú©Ù…Ù‡ Ø´Ù†Ø§ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª */
      .note-toggle-button {
        position: fixed;
        top: 50px;
        left: 20px;
        width: 50px;
        height: 50px;
        background-color: #4caf50;
        border-radius: 50%;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        border: none;
        font-size: 24px;
      }
      
      .note-toggle-button:hover {
        background-color: #45a049;
      }
      
      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ identify */
      .identify {
        position: relative;
      }
      
      .identify__icon {
        cursor: pointer;
      }
      
      .identify__content {
        display: none;
        position: fixed;
        left: auto;
        right: 0;
        top: 0;
        bottom: 0;
        width: 30%;
        height: 100%;
        background-color: white;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
        padding: 10px;
        z-index: 1000;
        box-sizing: border-box;
        overflow-y: auto;
      }
      
      .identify.active .identify__content {
        display: block;
      }
      
      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¨Ø®Ø´ Ø¹Ú©Ø³ Ø¯Ø± Ù¾Ù†Ù„ identify */
      .identify__layout {
        display: flex;
        height: calc(100% - 40px);
        flex-direction: column;
      }
      
      .identify__data {
        flex: 1;
        padding-right: 10px;
        overflow-y: auto;
        margin-bottom: 20px;
      }
      
      .identify__photo-panel {
        width: 100%;
        border-top: 1px solid #ccc;
        padding: 10px;
        display: flex;
        flex-direction: column;
        height: 50%;
      }
      
      .identify__photo-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
      }
      
      .identify__photo {
        max-width: 100%;
        max-height: 300px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
      }
      
      .identify__photo-info {
        width: 100%;
        padding: 10px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 10px;
      }
      
      .identify__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      
      .identify__title {
        font-weight: bold;
        font-size: 18px;
      }
      
      .identify__add-photo {
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
      }
      
      .identify__add-photo:hover {
        background-color: #45a049;
      }
      
      .identify__add-photo:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ */
      .photo-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }
      
      .photo-modal.active {
        display: flex;
      }
      
      .photo-modal__content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        width: 500px;
        max-width: 90%;
      }
      
      .photo-modal__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      
      .photo-modal__title {
        font-weight: bold;
        font-size: 18px;
      }
      
      .photo-modal__close {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
      }
      
      .photo-modal__form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      
      .photo-modal__preview {
        max-width: 100%;
        max-height: 200px;
        margin: 10px 0;
        display: none;
      }
      
      .photo-modal__description {
        width: 100%;
        height: 100px;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      
      .photo-modal__submit {
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 10px;
        cursor: pointer;
      }
      
      .photo-modal__submit:hover {
        background-color: #45a049;
      }

      /* ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ */
      .tools {
        transition: right 0.3s ease;
      }
      
      body.body-shifted .tools {
        right: 30%;
      }

      body.body-shifted {
        margin-right: 30%;
      }

      body.body-shifted #map {
        width: 100% !important;
      }

    </style>
  </head>

  <body>
    <!-- Ù‡Ø¯Ø± Ø¨Ø§ Ù„ÙˆÚ¯ÙˆÙ‡Ø§ -->
    <div class="header">
      <img class="logo" src="{% static 'kabul/images/WhatsApp_Image_2025-05-15_at_9.52.25_AM-removebg-preview.png' %}" alt="MOHE Logo"/>

      <h1>Ù†Ù‚Ø´Ù‡ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ Ø´Ù‡Ø± Ú©Ø§Ø¨Ù„</h1>
   <img class="logo" src="{% static 'kabul/images/New_GE_Logo_1-removebg-preview.png' %}" alt="KPU Logo" />

    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø´Ù†Ø§ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª -->
    <button class="note-toggle-button" id="noteToggleButton">ğŸ“</button>

    <!-- Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª -->
    <div class="sticky-note" id="stickyNote">
      <div class="sticky-note-header" id="stickyNoteHeader">
        <h3 class="sticky-note-title">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h3>
        <div class="sticky-note-controls">
          <button id="minimizeNote" title="Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù†">_</button>
          <button id="deleteNote" title="Ø­Ø°Ù">Ã—</button>
        </div>
      </div>
      <div class="sticky-note-content">
        <textarea id="noteContent" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
      </div>
      <div class="sticky-note-footer">
        <button class="save-btn" id="saveNote">Ø°Ø®ÛŒØ±Ù‡</button>
        <button class="cancel-btn" id="cancelEdit">Ù„ØºÙˆ</button>
      </div>
    </div>

    <!-- Ù†Ù‚Ø´Ù‡ OpenLayers -->
    <div id="map">
    <div class="layer-switcher">
        <div class="layer-switcher-container">
          <div class="layer-switcher__icon"></div>
        </div>
        <div class="layer-switcher__content"></div>
    </div>
    <div class="tooltip-bottom"></div>
      <div class="search-box">
        <div class="search-button"></div>
        <input class="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ" type="text" />
      </div>
    </div>
    
    <div class="tools">
      
      <div class="drawing-control">
          <div class="user-button"></div>
          <div class="drawing-control__icon drawing-control__icon--toggler"></div>
          <div class="drawing-control__icon drawing-control__icon--point"></div>
          <div class="drawing-control__icon drawing-control__icon--line"></div>
          <div class="drawing-control__icon drawing-control__icon--polygon"></div>
          <div class="drawing-control__icon drawing-control__icon--finish"></div>
          <div class="drawing-control__icon drawing-control__icon--clear"></div>
      </div>
      
      <div class="measurement-control">
          <div class="measurement-control__icon measurement-control__icon--toggler"></div>
          <div class="measurement-control__icon measurement-control__icon--distance"></div>
          <div class="measurement-control__icon measurement-control__icon--area"></div>
      </div>

      <div class="identify">
          <div class="identify__icon"></div>
          <div class="identify__content">
              <div class="identify__header">
                  <div class="identify__title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ø§Ø±Ø¶Ù‡</div>
              </div>
              <div class="identify__layout">
                  <div class="identify__data">
              <div class="identify__select">
                      </div>
                      <div class="identify__result"></div>
                  </div>
                  <div class="identify__photo-panel">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                          <h3>Ø¹Ú©Ø³â€ŒÙ‡Ø§</h3>
                          <button class="identify__add-photo" id="addPhotoBtn">Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³</button>
                      </div>
                      <div class="identify__photo-container" id="photoContainer">
                          <!-- Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                          <div class="identify__no-photo">Ù‡ÛŒÚ† Ø¹Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¹Ø§Ø±Ø¶Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ -->
    <div class="photo-modal" id="photoModal">
        <div class="photo-modal__content">
            <div class="photo-modal__header">
                <div class="photo-modal__title">Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯</div>
                <button class="photo-modal__close" id="closeModalBtn">&times;</button>
            </div>
            <form class="photo-modal__form" id="photoUploadForm" enctype="multipart/form-data">
                <div>
                    <label for="photoFile">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³:</label>
                    <input type="file" id="photoFile" name="photo" accept="image/*" required>
                </div>
                <img class="photo-modal__preview" id="photoPreview">
                <div>
                    <label for="photoDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¹Ú©Ø³:</label>
                    <textarea class="photo-modal__description" id="photoDescription" name="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¹Ú©Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                </div>
                <button type="submit" class="photo-modal__submit">Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³</button>
            </form>
        </div>
    </div>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª OpenLayers -->
    <script src="{% static 'kabul/proxy.js' %}"></script>
    <script>
      // Ø³Ø§Ø®Øª Ù†Ù‚Ø´Ù‡ OpenLayers
      const map = new ol.Map({
        target: "map",
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM(),
          }),
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([69.2075, 34.5553]), // Ù…Ø±Ú©Ø² Ú©Ø§Ø¨Ù„
          zoom: 12, // Ø³Ø·Ø­ Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ
        }),
      });

        // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡ OpenLayers Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
        console.log('Ù†Ø³Ø®Ù‡ OpenLayers:', ol.VERSION);

    </script>
   <script src="{% static 'kabul/app.js' %}"></script>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const stickyNote = document.getElementById('stickyNote');
        const stickyNoteHeader = document.getElementById('stickyNoteHeader');
        const noteContent = document.getElementById('noteContent');
        const saveNoteBtn = document.getElementById('saveNote');
        const cancelEditBtn = document.getElementById('cancelEdit');
        const deleteNoteBtn = document.getElementById('deleteNote');
        const minimizeNoteBtn = document.getElementById('minimizeNote');
        const noteToggleButton = document.getElementById('noteToggleButton');
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
        if (localStorage.getItem('stickyNoteContent')) {
          noteContent.value = localStorage.getItem('stickyNoteContent');
        }
        
        // Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø´Ù†Ø§ÙˆØ±
        noteToggleButton.addEventListener('click', function() {
          if (stickyNote.style.display === 'none' || stickyNote.style.display === '') {
            stickyNote.style.display = 'block';
          } else {
            stickyNote.style.display = 'none';
          }
        });
        
        // Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
        saveNoteBtn.addEventListener('click', function() {
          localStorage.setItem('stickyNoteContent', noteContent.value);
          alert('ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
        });
        
        // Ù„ØºÙˆ ØªØºÛŒÛŒØ±Ø§Øª
        cancelEditBtn.addEventListener('click', function() {
          if (localStorage.getItem('stickyNoteContent')) {
            noteContent.value = localStorage.getItem('stickyNoteContent');
          } else {
            noteContent.value = '';
          }
        });
        
        // Ø­Ø°Ù ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
        deleteNoteBtn.addEventListener('click', function() {
          if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
            localStorage.removeItem('stickyNoteContent');
            noteContent.value = '';
          }
        });
        
        // Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù†/Ø¨Ø²Ø±Ú¯ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
        minimizeNoteBtn.addEventListener('click', function() {
          stickyNote.classList.toggle('minimized');
          if (stickyNote.classList.contains('minimized')) {
            minimizeNoteBtn.textContent = 'â–¡';
            minimizeNoteBtn.title = 'Ø¨Ø²Ø±Ú¯ Ú©Ø±Ø¯Ù†';
          } else {
            minimizeNoteBtn.textContent = '_';
            minimizeNoteBtn.title = 'Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù†';
          }
        });
        
        // Ø§Ù…Ú©Ø§Ù† Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ù¾Ù†Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
        let isDragging = false;
        let offsetX, offsetY;
        
        stickyNoteHeader.addEventListener('mousedown', function(e) {
          isDragging = true;
          offsetX = e.clientX - stickyNote.getBoundingClientRect().left;
          offsetY = e.clientY - stickyNote.getBoundingClientRect().top;
        });
        
        document.addEventListener('mousemove', function(e) {
          if (isDragging) {
            stickyNote.style.left = (e.clientX - offsetX) + 'px';
            stickyNote.style.top = (e.clientY - offsetY) + 'px';
          }
        });
        
        document.addEventListener('mouseup', function() {
          isDragging = false;
        });
        
        // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡ identify
        const identifyElement = document.querySelector('.identify');
        const identifyIcon = document.querySelector('.identify__icon');
        const mapElement = document.getElementById('map');
        const toolsElement = document.querySelector('.tools');
        const bodyElement = document.body;
        const headerElement = document.querySelector('.header');
        
        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„
        function openIdentifyPanel() {
          identifyElement.classList.add('active');
          bodyElement.classList.add('body-shifted');
        }
        
        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù¾Ù†Ù„
        function closeIdentifyPanel() {
          identifyElement.classList.remove('active');
          bodyElement.classList.remove('body-shifted');
        }
        
        // Ø¨Ø§Ø² Ùˆ Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ†
        identifyIcon.addEventListener('click', function() {
          if (identifyElement.classList.contains('active')) {
            closeIdentifyPanel();
          } else {
            openIdentifyPanel();
          }
        });
        
        // Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¯Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³
        const photoModal = document.getElementById('photoModal');
        const addPhotoBtn = document.getElementById('addPhotoBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const photoUploadForm = document.getElementById('photoUploadForm');
        const photoFile = document.getElementById('photoFile');
        const photoPreview = document.getElementById('photoPreview');
        const photoContainer = document.getElementById('photoContainer');
        const identifySelect = document.querySelector('.identify__select');
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        let selectedFeature = null;
        let selectedFeatureType = null;
        let selectedCoordinates = null;
        
        // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§
        addPhotoBtn.disabled = true;
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙˆÛŒÚ˜Ú¯ÛŒ
        const featurePhotos = {};
        
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆÛŒÚ˜Ú¯ÛŒ (Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØªØŒ Ø§ÛŒÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ù†Ù‚Ø´Ù‡ Ù…ÛŒâ€ŒØ¢ÛŒÙ†Ø¯)
        function createFeatureSelector() {
          // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ù‚Ø¨Ù„ÛŒ
          identifySelect.innerHTML = '';
          
          // Ø§ÛŒØ¬Ø§Ø¯ Ø¹Ù†ÙˆØ§Ù†
          const title = document.createElement('h4');
          title.textContent = 'Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø¹Ø§Ø±Ø¶Ù‡:';
          identifySelect.appendChild(title);
          
          // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø§Ù¾â€ŒØ¯Ø§ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø¹Ø§Ø±Ø¶Ù‡
          const select = document.createElement('select');
          select.id = 'featureTypeSelect';
          select.style.width = '100%';
          select.style.padding = '5px';
          select.style.marginBottom = '10px';
          
          // Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø§Ù¾â€ŒØ¯Ø§ÙˆÙ†
          const options = [
            { value: '', text: 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...' },
            { value: 'area_name', text: 'Ù…Ù†Ø·Ù‚Ù‡ (Area Name)' },
            { value: 'hospital', text: 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† (Hospital)' },
            { value: '22_district', text: 'Ù†Ø§Ø­ÛŒÙ‡ 22 (22 District)' }
          ];
          
          options.forEach(option => {
            const optElement = document.createElement('option');
            optElement.value = option.value;
            optElement.textContent = option.text;
            select.appendChild(optElement);
          });
          
          identifySelect.appendChild(select);
          
          // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨
          select.addEventListener('change', function() {
            const selectedValue = this.value;
            selectedFeatureType = selectedValue;
            
            // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³
            addPhotoBtn.disabled = !selectedValue;
            
            if (selectedValue) {
              // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒÚ© ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ø§ Ù…Ø®ØªØµØ§Øª
              selectedFeature = {
                type: selectedValue,
                id: 'feature_' + Date.now(),
                name: options.find(opt => opt.value === selectedValue).text
              };
              
              // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø®ØªØµØ§Øª (Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØªØŒ Ø§ÛŒÙ† Ø§Ø² Ù†Ù‚Ø´Ù‡ Ù…ÛŒâ€ŒØ¢ÛŒØ¯)
              selectedCoordinates = [69.2075, 34.5553]; // Ù…Ø®ØªØµØ§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú©Ø§Ø¨Ù„
              
              // Ù†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ
              displayPhotosForFeature(selectedFeature.id);
            } else {
              selectedFeature = null;
              selectedCoordinates = null;
              
              // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¹Ú©Ø³â€ŒÙ‡Ø§
              photoContainer.innerHTML = '<div class="identify__no-photo">Ù‡ÛŒÚ† Ø¹Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¹Ø§Ø±Ø¶Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
            }
          });
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÛŒÚ© ÙˆÛŒÚ˜Ú¯ÛŒ
        function displayPhotosForFeature(featureId) {
          // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ù‚Ø¨Ù„ÛŒ
          photoContainer.innerHTML = '';
          
          // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¹Ú©Ø³ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ
          if (featurePhotos[featureId] && featurePhotos[featureId].length > 0) {
            featurePhotos[featureId].forEach(photo => {
              // Ø§ÛŒØ¬Ø§Ø¯ Ø¹Ù†Ø§ØµØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ù†
              const photoWrapper = document.createElement('div');
              photoWrapper.style.marginBottom = '20px';
              
              const img = document.createElement('img');
              img.src = photo.src;
              img.className = 'identify__photo';
              
              const info = document.createElement('div');
              info.className = 'identify__photo-info';
              info.textContent = photo.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª';
              
              // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡
              photoWrapper.appendChild(img);
              photoWrapper.appendChild(info);
              photoContainer.appendChild(photoWrapper);
            });
          } else {
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… "Ø¨Ø¯ÙˆÙ† Ø¹Ú©Ø³"
            photoContainer.innerHTML = '<div class="identify__no-photo">Ù‡ÛŒÚ† Ø¹Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¹Ø§Ø±Ø¶Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
          }
        }
        
        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÚ¯Ø± ÙˆÛŒÚ˜Ú¯ÛŒ Ø¯Ø± Ø²Ù…Ø§Ù† Ø¨Ø§Ø² Ø´Ø¯Ù† Ù¾Ù†Ù„
        identifyIcon.addEventListener('click', function() {
          if (!identifyElement.classList.contains('active')) {
            // Ø§Ú¯Ø± Ù¾Ù†Ù„ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ø´Ø¯Ù† Ø§Ø³ØªØŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÚ¯Ø± ÙˆÛŒÚ˜Ú¯ÛŒ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
            setTimeout(createFeatureSelector, 100);
          }
        });
        
        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ú©Ø³
        addPhotoBtn.addEventListener('click', function() {
          if (selectedFeature) {
            photoModal.classList.add('active');
          }
        });
        
        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
        closeModalBtn.addEventListener('click', function() {
          photoModal.classList.remove('active');
        });
        
        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² Ø¢Ù†
        photoModal.addEventListener('click', function(e) {
          if (e.target === photoModal) {
            photoModal.classList.remove('active');
          }
        });
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        photoFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              photoPreview.src = e.target.result;
              photoPreview.style.display = 'block';
            };
            
            reader.readAsDataURL(this.files[0]);
          }
        });
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³
        photoUploadForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          if (photoFile.files && photoFile.files[0] && selectedFeature) {
            const reader = new FileReader();
            const description = document.getElementById('photoDescription').value;
            
            reader.onload = function(e) {
              // Ø§ÛŒØ¬Ø§Ø¯ Ø´ÛŒØ¡ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯
              const newPhoto = {
                src: e.target.result,
                description: description,
                featureId: selectedFeature.id,
                featureType: selectedFeature.type,
                coordinates: selectedCoordinates,
                timestamp: Date.now()
              };
              
              // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ú©Ø³ Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ
              if (!featurePhotos[selectedFeature.id]) {
                featurePhotos[selectedFeature.id] = [];
              }
              
              featurePhotos[selectedFeature.id].push(newPhoto);
              
              // Ù†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡
              displayPhotosForFeature(selectedFeature.id);
              
              // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
              try {
                localStorage.setItem('featurePhotos', JSON.stringify(featurePhotos));
              } catch (error) {
                console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø¯Ø± localStorage:', error);
              }
              
              // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ùˆ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
              photoModal.classList.remove('active');
              photoUploadForm.reset();
              photoPreview.style.display = 'none';
            };
            
            reader.readAsDataURL(photoFile.files[0]);
          }
        });
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø² localStorage Ø¯Ø± Ø²Ù…Ø§Ù† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        try {
          const savedPhotos = localStorage.getItem('featurePhotos');
          if (savedPhotos) {
            Object.assign(featurePhotos, JSON.parse(savedPhotos));
          }
        } catch (error) {
          console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø§Ø² localStorage:', error);
        }
      });
    </script>
     
</body>
</html>
